<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç–ª–∞–¥–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #1a1a1a;
            color: white;
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #404040;
            border-radius: 8px;
            background-color: #2d2d2d;
        }
        button {
            background-color: #4dabf7;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #339af0;
        }
        .error {
            color: #ff6b6b;
        }
        .success {
            color: #51cf66;
        }
        pre {
            background-color: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîç –û—Ç–ª–∞–¥–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã</h1>
    
    <div class="debug-section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ localStorage</h2>
        <button onclick="checkLocalStorage()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å localStorage</button>
        <div id="localStorage-debug"></div>
    </div>

    <div class="debug-section">
        <h2>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä–∑–∏–Ω—ã</h2>
        <button onclick="checkCartStructure()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É</button>
        <div id="structure-debug"></div>
    </div>

    <div class="debug-section">
        <h2>3. –¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞</h2>
        <button onclick="testAddProduct()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä</button>
        <div id="add-debug"></div>
    </div>

    <div class="debug-section">
        <h2>4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã</h2>
        <button onclick="checkCart()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
        <div id="cart-debug"></div>
    </div>

    <div class="debug-section">
        <h2>5. –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã</h2>
        <button onclick="clearCart()" style="background-color: #dc3545;">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
        <div id="clear-debug"></div>
    </div>

    <script>
        function checkLocalStorage() {
            const result = document.getElementById('localStorage-debug');
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å localStorage
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ—Ä–∑–∏–Ω—É
                const cart = localStorage.getItem('cart');
                
                result.innerHTML = `
                    <div class="success">‚úÖ localStorage —Ä–∞–±–æ—Ç–∞–µ—Ç</div>
                    <div>–ö–æ—Ä–∑–∏–Ω–∞ –≤ localStorage: ${cart ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'}</div>
                    <pre>${cart || 'null'}</pre>
                `;
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå localStorage –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç: ${error.message}</div>`;
            }
        }

        function checkCartStructure() {
            const result = document.getElementById('structure-debug');
            try {
                const testProduct = {
                    id: 1,
                    name: "–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä",
                    description: "–û–ø–∏—Å–∞–Ω–∏–µ",
                    price: 1000,
                    categoryId: 1
                };

                const testCartItem = {
                    id: '1-1234567890',
                    product: testProduct,
                    quantity: 1,
                    addedAt: new Date()
                };

                const testCart = {
                    items: [testCartItem],
                    totalItems: 1,
                    totalPrice: 1000
                };

                result.innerHTML = `
                    <div class="success">‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞</div>
                    <pre>${JSON.stringify(testCart, null, 2)}</pre>
                `;
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: ${error.message}</div>`;
            }
        }

        function testAddProduct() {
            const result = document.getElementById('add-debug');
            try {
                const testProduct = {
                    id: 1,
                    name: "–¢–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä",
                    description: "–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ç–æ–≤–∞—Ä–∞",
                    price: 1000,
                    categoryId: 1
                };

                // –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–æ—Ä–∑–∏–Ω—É
                let cart = JSON.parse(localStorage.getItem('cart') || '[]');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π —Ç–æ–≤–∞—Ä
                const existingIndex = cart.findIndex(item => item.product.id === testProduct.id);
                
                if (existingIndex !== -1) {
                    cart[existingIndex].quantity += 1;
                } else {
                    const newItem = {
                        id: `${testProduct.id}-${Date.now()}`,
                        product: testProduct,
                        quantity: 1,
                        addedAt: new Date()
                    };
                    cart.push(newItem);
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                localStorage.setItem('cart', JSON.stringify(cart));
                
                result.innerHTML = `
                    <div class="success">‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É</div>
                    <pre>${JSON.stringify(cart, null, 2)}</pre>
                `;
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: ${error.message}</div>`;
            }
        }

        function checkCart() {
            const result = document.getElementById('cart-debug');
            try {
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
                const totalPrice = cart.reduce((total, item) => total + (item.product.price * item.quantity), 0);
                
                result.innerHTML = `
                    <div class="success">‚úÖ –ö–æ—Ä–∑–∏–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞</div>
                    <div>–¢–æ–≤–∞—Ä–æ–≤: ${totalItems}</div>
                    <div>–°—Ç–æ–∏–º–æ—Å—Ç—å: ${totalPrice.toLocaleString('ru-RU')} ‚ÇΩ</div>
                    <div>–≠–ª–µ–º–µ–Ω—Ç–æ–≤: ${cart.length}</div>
                    <pre>${JSON.stringify(cart, null, 2)}</pre>
                `;
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ—Ä–∑–∏–Ω—ã: ${error.message}</div>`;
            }
        }

        function clearCart() {
            const result = document.getElementById('clear-debug');
            try {
                localStorage.removeItem('cart');
                result.innerHTML = '<div class="success">‚úÖ –ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞</div>';
            } catch (error) {
                result.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏: ${error.message}</div>`;
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º localStorage –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            checkLocalStorage();
            checkCartStructure();
        };
    </script>
</body>
</html>
