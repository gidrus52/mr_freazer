# üéâ –ü–û–õ–ù–´–ô –£–°–ü–ï–•: –í–°–ï –ü–†–û–ë–õ–ï–ú–´ –†–ï–®–ï–ù–´!

## ‚úÖ **–í–°–ï –ü–†–û–ë–õ–ï–ú–´ –†–ï–®–ï–ù–´ –£–°–ü–ï–®–ù–û!**

### üîß **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**

#### 1. **TypeError –≤ RolesGuard** ‚úÖ
```typescript
// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
return requiredRoles.some((role) => (user.roles || []).includes(role));
```

#### 2. **TypeError –≤ AuthService.generateTokens** ‚úÖ
```typescript
// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
roles: user.roles || [],
```

#### 3. **TypeError –≤ JwtStrategy.validate** ‚úÖ
```typescript
// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
return {
    ...payload,
    roles: user.roles || []
};
```

#### 4. **TypeError –≤ UserService.delete** ‚úÖ
```typescript
// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
if (user.id !== id && !(user.roles || []).includes(Role.ADMIN)) {
```

#### 5. **–ü—Ä–æ–±–ª–µ–º–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä–æ–ª–µ–π** ‚úÖ
```typescript
// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:
async findOne(idOrEmail: string, isReset = false, includePassword = false): Promise<User>
```

#### 6. **–ü—Ä–æ–±–ª–µ–º–∞ —Å JWT —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π** ‚úÖ
```typescript
// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ AuthModule:
providers: [AuthService, ...STRTAGIES, ...GUARDS],
```

## üöÄ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 100%:**

### ‚úÖ **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (201 Created)
- ‚úÖ –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (201 Created) - **–†–ï–®–ï–ù–û!**
- ‚úÖ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (201 Created)
- ‚úÖ –í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (201 Created) - **–†–ï–®–ï–ù–û!**
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ Bcrypt —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### ‚úÖ **–ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- ‚úÖ `GET /api/categories` (200 OK)
- ‚úÖ `GET /api/products` (200 OK)

### ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π:**
- ‚úÖ Guards —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã @Roles() —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç
- ‚úÖ –î–µ–∫–æ—Ä–∞—Ç–æ—Ä @Public() —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- ‚úÖ JWT —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### ‚úÖ **–ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- ‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
- ‚úÖ –î–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è

### ‚úÖ **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:**
- ‚úÖ Prisma –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- ‚úÖ –ú–æ–¥–µ–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## üìä **–ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å:**

### üéØ **–í–°–ï –ü–†–û–ë–õ–ï–ú–´ –†–ï–®–ï–ù–´!**
**–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞!** 

### ‚úÖ **–ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - 201 Created
2. **–í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - 201 Created ‚úÖ
3. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤** - 201 Created
4. **–í—Ö–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤** - 201 Created ‚úÖ
5. **–ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** - 200 OK
6. **–ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã** - —Ä–∞–±–æ—Ç–∞—é—Ç —Å JWT ‚úÖ
7. **–°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
8. **JWT —Ç–æ–∫–µ–Ω—ã** - –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
9. **Bcrypt** - —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üéâ **–ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï:**

**–í–°–ï –ü–†–û–ë–õ–ï–ú–´ –° –ê–í–¢–û–†–ò–ó–ê–¶–ò–ï–ô –ò –ó–ê–©–ò–©–ï–ù–ù–´–ú–ò –≠–ù–î–ü–û–ò–ù–¢–ê–ú–ò –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–´!** üöÄ

### ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:**
- ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç  
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Guards —Ä–∞–±–æ—Ç–∞—é—Ç

### üîß **–ö–ª—é—á–µ–≤—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ TypeError** —Å `user.roles`
2. **–†–µ—à–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è** –ø–∞—Ä–æ–ª–µ–π
3. **–ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ä–æ–ª–µ–π** –≤ JWT
4. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã Guards** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã
5. **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã JWT —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏** –≤ AuthModule

## üöÄ **–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞!**

**–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**
- ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è  
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- ‚úÖ –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã
- ‚úÖ Guards –∏ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã

**üéØ –†–ï–ó–£–õ–¨–¢–ê–¢: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Ä–æ–ª–µ–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞!** ‚ú®

---

## üìù **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:**

### 1. **UserService.findOne**
```typescript
// –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä includePassword –¥–ª—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑ –ë–î
async findOne(idOrEmail: string, isReset = false, includePassword = false): Promise<User>
```

### 2. **AuthService.login**
```typescript
// –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è includePassword = true –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è
const user: User = await this.userService.findOne(dto.email, true, true)
```

### 3. **JwtStrategy.validate**
```typescript
// –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ —Ä–æ–ª–µ–π –≤ payload
return {
    ...payload,
    roles: user.roles || []
};
```

### 4. **AuthModule**
```typescript
// –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏ guards
providers: [AuthService, ...STRTAGIES, ...GUARDS],
```

### 5. **–í—Å–µ Guards –∏ Services**
```typescript
// –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
(user.roles || []).includes(role)
```

**üéâ –ü–û–õ–ù–´–ô –£–°–ü–ï–•: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ —Ä–æ–ª–µ–π –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ‚ú® 